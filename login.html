<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title id="pageTitle">Login</title>
<link rel="stylesheet" href="style.css">
<style>
/* 為了確保在 login.html 中使用 style.css 的 login-page 樣式，這裡直接引用 */
/* 請確保 style.css 裡的 .login-page 和 .login-box 樣式存在 (我已在 style.css 中提供) */
</style>
</head>
<body class="login-page">

<div class="login-box">
  <h2 id="title">Login</h2>

  <form id="loginForm">
    <input type="text" name="nickname" placeholder="Nickname" style="display:none" required>
    
    <input type="email" name="email" placeholder="Email" required>
    <input type="password" name="password" placeholder="Password" required>
    
    <button type="submit" class="btn primary full">Login</button>
  </form>

  <p class="switch">
    No account?
    <a href="#" id="toggle">Register</a>
  </p>
</div>

<script>
const USER_KEY = 'users';
const CURRENT_USER = 'currentUser';
const form = document.getElementById('loginForm');
const toggle = document.getElementById('toggle');
const title = document.getElementById('title');
let mode = 'login'; // 預設為登入模式

function getUsers(){
  return JSON.parse(localStorage.getItem(USER_KEY)) || [];
}

// 點擊切換模式
toggle.onclick = () => {
  mode = mode === 'login' ? 'register' : 'login';
  
  // 更新介面文字
  title.textContent = mode === 'login' ? 'Login' : 'Register';
  form.querySelector('button').textContent = title.textContent;
  
  // 顯示/隱藏暱稱欄位
  const nicknameInput = form.querySelector('input[name="nickname"]');
  nicknameInput.style.display = mode === 'register' ? 'block' : 'none';
  nicknameInput.required = mode === 'register';

  // 更新切換連結文字
  toggle.textContent = mode === 'login' ? 'Register' : 'Login';
  document.querySelector('.switch').innerHTML = mode === 'login' 
    ? 'No account? <a href="#" id="toggle">Register</a>'
    : 'Already have an account? <a href="#" id="toggle">Login</a>';
    
  // 重新綁定 toggle 事件 (因為 innerHTML 變了)
  document.getElementById('toggle').onclick = toggle.onclick; 
  
  // 清空表單
  form.reset();
};

form.onsubmit = e => {
  e.preventDefault();
  const email = form.email.value;
  const pw = form.password.value;
  const nickname = form.nickname.value;
  let users = getUsers();

  if (mode === 'register') {
    // 註冊邏輯
    if (users.find(u => u.email === email)) {
      alert('此帳號已被註冊');
      return;
    }
    
    // 儲存新用戶
    users.push({email, pw, nickname});
    localStorage.setItem(USER_KEY, JSON.stringify(users));
    
    alert('註冊成功！請使用新帳號登入。');
    
    // 註冊成功後，切換回登入模式
    toggle.onclick(); 

  } else {
    // 登入邏輯
    const user = users.find(u => u.email === email && u.pw === pw);
    
    if (!user) {
      alert('電子郵件或密碼錯誤');
      return;
    }
    
    // 登入成功：將不含密碼的公開資訊存入 CURRENT_USER
    localStorage.setItem(CURRENT_USER, JSON.stringify({email: user.email, nickname: user.nickname}));
    
    // 跳轉到主頁面
    location.href = 'index.html';
  }
};
</script>

</body>
</html>
