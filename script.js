// ======================================================= // 全域變數和輔助函式 // ======================================================= const ITEM_STORAGE_KEY = 'donatedItems'; const donationForm = document.getElementById('donation-form'); const itemImageInput = document.getElementById('itemImage'); const imagePreviewDiv = document.getElementById('imagePreview'); const itemListDiv = document.getElementById('item-list'); const successModal = document.getElementById('success-modal'); const modalClose = document.getElementById('modalClose'); const modalBack = document.getElementById('modalBack'); // 儲存最新的 Base64 圖片數據 let currentBase64Image = null; /** * 從 localStorage 讀取所有捐贈項目 * @returns {Array} 捐贈項目列表 */ function getItems() { const data = localStorage.getItem(ITEM_STORAGE_KEY); return data ? JSON.parse(data) : []; } /** * 將項目列表儲存到 localStorage * @param {Array} items 項目列表 */ function saveItems(items) { localStorage.setItem(ITEM_STORAGE_KEY, JSON.stringify(items)); } // ======================================================= // 2. 渲染邏輯：將儲存的項目顯示在頁面上 // ======================================================= function renderItems(items) { if (!itemListDiv) return; itemListDiv.innerHTML = ''; if (items.length === 0) { itemListDiv.innerHTML = '<p style="grid-column: 1 / -1; text-align: center; color: #888;">No donated items available yet.</p>'; return; } items.forEach(item => { // 創建一個代表捐贈項目的卡片 const card = document.createElement('div'); card.classList.add('item-card'); // 確保圖片來源是 Base64 字串 const imageUrl = item.image ? item.image : 'placeholder.jpg'; card.innerHTML = <div class="item-image-wrap"> <img src="${imageUrl}" alt="${item.itemName}" class="item-image" /> </div> <div class="item-info"> <h4>${item.itemName} (${item.condition})</h4> <p>Category: <strong>${item.category}</strong></p> <p class="item-description">${item.description.substring(0, 50)}...</p> </div> ; itemListDiv.appendChild(card); }); } // ======================================================= // 3. 實時圖片預覽功能 (Image Preview) // ======================================================= if (itemImageInput && imagePreviewDiv) { itemImageInput.addEventListener('change', function(event) { const file = event.target.files[0]; currentBase64Image = null; // 重置 Base64 數據 if (file) { imagePreviewDiv.innerHTML = ''; if (!file.type.startsWith('image/')) { imagePreviewDiv.innerHTML = '<p class="error-text">Please upload a valid image file.</p>'; return; } const reader = new FileReader(); reader.onload = function(e) { // 儲存 Base64 字串，供表單提交時使用 currentBase64Image = e.target.result; const img = document.createElement('img'); img.src = currentBase64Image; img.alt = "Item Preview"; img.classList.add('preview-image'); imagePreviewDiv.appendChild(img); }; reader.readAsDataURL(file); } else { imagePreviewDiv.innerHTML = ''; } }); } // ======================================================= // 4. 表單提交與數據儲存邏輯 (Form Submission and Storage) // ======================================================= if (donationForm) { donationForm.addEventListener('submit', function(event) { event.preventDefault(); // 確保圖片已經被成功讀取 (currentBase64Image != null) if (!currentBase64Image) { alert("Please wait for the image to load or select a file."); return; } // 從表單中獲取數據 const formData = new FormData(donationForm); const newItem = { itemName: formData.get('itemName'), category: formData.get('category'), condition: formData.get('condition'), description:
